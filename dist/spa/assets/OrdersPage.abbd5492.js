import{_ as le,r as d,c as i,o as z,l as I,x as L,n as m,d as l,aD as Y,A as V,q as s,u as re,v as oe,aI as D,M as v,bj as se,aC as de,b as ue,bk as ne,b7 as ie,aF as me,aG as ce,L as pe,w as _e,m as K,t as B,F as ve,Q as H}from"./index.741a3cbc.js";import{Q as J}from"./QSelect.99d80d0f.js";import{Q as W,e as be}from"./exportToExcel.d89b3f16.js";import{u as X}from"./use-quasar.088138f3.js";import{Q as Z}from"./QSpinnerFacebook.f49bcbaa.js";import{u as ee}from"./format.b5946461.js";import{Q as fe}from"./TouchPan.72e21371.js";import{Q as ye}from"./QScrollArea.0da9f460.js";import{Q as ge}from"./QForm.972f20fc.js";import"./QList.de37d55a.js";import"./QMarkupTable.12ab3156.js";import"./axios.851d6ad1.js";import"./touch.3df10340.js";import"./QResizeObserver.a9dbfe29.js";import"./QScrollObserver.5b685606.js";const C=x=>(me("data-v-44e2286b"),x=x(),ce(),x),De=C(()=>s("div",{class:"text-h6 text-bold",style:{color:"#123499"}}," Edit Order Details ",-1)),he={class:"text-bold"},Se={class:"text-green"},Ce=C(()=>s("div",{class:"text-bold q-mt-md"},"Delivery Date",-1)),xe=C(()=>s("div",{class:"text-bold q-mt-md"},"Courier Date",-1)),we=C(()=>s("div",{class:"text-bold q-mt-md"},"Courier Tracking Number",-1)),Ne=C(()=>s("div",{class:"text-bold q-mt-xs"},"Name of the Courier",-1)),Te=C(()=>s("div",{class:"text-bold q-mt-xs"},"Delivery Address",-1)),Ve=C(()=>s("div",{class:"text-bold q-mt-xs"},"Order Status",-1)),Oe={__name:"editOrderDetailsModal",props:{showNewUserPopup:{type:Boolean,required:!0,default:!1},closeNewUserPopup:{type:Function,required:!0},selectedData:{type:Object,required:!0}},setup(x){const o=x,b=ee(),f=X(),n=d(""),c=d(""),w=d(o.selectedData[0].delivery_number),G=d(o.selectedData[0].customer_name),y=d(o.selectedData[0].delivery_through),N=d(o.selectedData[0].delivery_address),p=d(o.selectedData[0].order_status);let u=[{label:"yet_to_be_couriered",name:"Yet to be Couriered"},{label:"in_transit",name:"In Transit"},{label:"delivered",name:"Delivered"},{label:"cancelled",name:"Cancelled"}];const g=i({get:()=>o.showNewUserPopup,set:()=>o.closeNewUserPopup()}),O=i(()=>u.map(t=>t.name)),T=i(()=>["Yet to be Couriered","Delivered","Cancelled"].includes(o.selectedData[0].order_status)),h=i(()=>o.selectedData[0].order_status!=="Yet to be Couriered"),S=i(()=>o.selectedData[0].order_status==="In Transit"),P=i(()=>o.selectedData[0].order_status==="In Transit"),$=i(()=>o.selectedData[0].order_status==="In Transit"),R=i(()=>u.find(e=>e.name===p.value).label),A=i(()=>{let t=_(w.value),e=_(y.value),a=_(N.value),r=p.value==="Yet to be Couriered",U=p.value==="In Transit",j=p.value==="Delivered",te=U&&c.value,ae=j&&n.value;return c.value&&n.value&&c.value>n.value||o.selectedData[0].order_status==="In Transit"&&!n.value||U&&n.value?!0:j?!ae:!t||!e||!a||r||!te}),Q=()=>{f.loading.show({spinner:Z,spinnerColor:"light-blue",messageColor:"white",backgroundColor:"light-blue",message:""})},M=()=>{f.loading.hide()},q=(t=!1)=>{o.closeNewUserPopup(t)},_=t=>t&&t.toString().trim().length>0,F=()=>{let t=o.selectedData[0].order_status;t!=="Yet to be Couriered"&&(t==="In Transit"?u=[{label:"delivered",name:"Delivered"},{label:"cancelled",name:"Cancelled"}]:(t==="Delivered"||t==="Cancelled")&&(u=[]))},k=t=>{const[e,a,r]=t.split("-");return`${r}-${a}-${e}`},E=()=>{var e;Q(),console.log("courier date",c.value);let t={delivery_date:(e=n.value)!=null?e:null,courier_date:c.value,delivery_details:{delivery_through:y.value,delivery_number:w.value,delivery_address:N.value},order_status:R.value};b.updateOrders(t,o.selectedData[0].uid).then(a=>{q(!0),f.notify({message:"Order Details Updated Successfully!!!",type:"positive",position:"top"})}).catch(a=>{f.notify({message:"Something went Wrong. Please contact your admin!!!",type:"negative",position:"top"})}).finally(()=>{M()})};return z(()=>{o.selectedData[0].courier_date&&(c.value=k(o.selectedData[0].courier_date)),o.selectedData[0].delivery_date&&(n.value=k(o.selectedData[0].delivery_date)),F()}),(t,e)=>(I(),L(ie,{modelValue:v(g),"onUpdate:modelValue":e[6]||(e[6]=a=>ue(g)?g.value=a:null),persistent:"",onKeydown:ne(q,["esc"])},{default:m(()=>[l(de,{class:"order-modal"},{default:m(()=>[l(Y,{class:"row items-center"},{default:m(()=>[De,l(fe),l(V,{icon:"close",flat:"",round:"",onClick:q})]),_:1}),l(ge,{onSubmit:E},{default:m(()=>[l(ye,{style:{height:"calc(95vh - 170px)"}},{default:m(()=>[l(Y,null,{default:m(()=>[s("div",he,[re(" Customer - "),s("span",Se,oe(G.value),1)]),Ce,l(D,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),style:{"max-width":"200px"},outlined:"",dense:"",autofocus:"",type:"date",disable:v(T)},null,8,["modelValue","disable"]),xe,l(D,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),style:{"max-width":"200px"},outlined:"",dense:"",autofocus:"",type:"date",disable:v(h)},null,8,["modelValue","disable"]),we,l(D,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=a=>w.value=a),style:{"max-width":"400px"},outlined:"",dense:"",autofocus:"",placeholder:"Enter a Courier Tracking Number",maxlength:"128",rules:[a=>_(a)||"Field is required!!!"],disable:v(S)},null,8,["modelValue","rules","disable"]),Ne,l(D,{modelValue:y.value,"onUpdate:modelValue":e[3]||(e[3]=a=>y.value=a),style:{"max-width":"400px"},outlined:"",dense:"",autofocus:"",placeholder:"Enter a Name of the Courier",maxlength:"128",rules:[a=>_(a)||"Field is required!!!"],disable:v(P)},null,8,["modelValue","rules","disable"]),Te,l(D,{modelValue:N.value,"onUpdate:modelValue":e[4]||(e[4]=a=>N.value=a),type:"textarea",style:{width:"400px"},outlined:"",dense:"",autofocus:"",rows:"2",placeholder:"Enter Delivery address.","input-class":"textarea-input",rules:[a=>_(a)||"Field is required!!!"],disable:v($)},null,8,["modelValue","rules","disable"]),Ve,l(J,{style:{width:"320px"},filled:"",modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=a=>p.value=a),options:v(O)},null,8,["modelValue","options"])]),_:1})]),_:1}),l(Y,{class:"row justify-end"},{default:m(()=>[l(se,{class:"q-px-none"},{default:m(()=>[l(V,{unelevated:"",color:"primary",label:"Save",type:"submit","no-caps":"",disable:v(A)},null,8,["disable"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"]))}};var qe=le(Oe,[["__scopeId","data-v-44e2286b"]]);const Ie={class:"row q-pt-md q-ml-lg"},Pe={class:"col-2"},Ae=s("p",{style:{color:"#123499"},class:"text-bold"},"From Date",-1),Qe={class:"col-2"},ke=s("p",{style:{color:"#123499"},class:"text-bold"},"To Date",-1),Ue={class:"col-2"},Ge=s("p",{style:{color:"#123499"},class:"text-bold"},"Courier Status",-1),$e={class:"col-2 q-ml-lg q-mt-lg"},Re={class:"q-ml-md q-mt-sm q-mr-lg q-pa-md"},Me={class:"row justify-start items-center"},Fe=s("span",{class:"q-ml-sm"},null,-1),Ee={key:0,class:"q-ml-md q-mt-sm q-mr-lg q-pa-md"},ot={__name:"OrdersPage",setup(x){const o=ee(),b=d(!1),f=X(),{orders:n}=pe(o);let c=[{name:"orderId",required:!0,label:"Order Id",align:"left",field:t=>t.order_id,format:t=>`${t}`,sortable:!0},{name:"orderDate",label:"Order Date",field:"order_date",sortable:!0},{name:"customerName",label:"Customer Name",field:"customer_name"},{name:"mobileNumber",label:"Mobile Number",field:"mobile_number"},{name:"referrerId",label:"Referrer Id",field:"referrer_id"},{name:"referrerName",label:"Referrer Name",field:"referrer_name"},{name:"referrerMobileNumber",label:"Referrer Mobile Number",field:"referrer_mobile_number"},{name:"totalProductPrice",label:"Total Product Price",field:"total_product_price"},{name:"cgst",label:"CGST Amount",field:"order_cgst_amount"},{name:"sgst",label:"SGST Amount",field:"order_sgst_amount"},{name:"igst",label:"IGST Amount",field:"order_igst_amount"},{name:"gstTotal",label:"GST Total Amount",field:"order_gst_total_amount"},{name:"orderTotal",label:"Order Total Amount",field:"order_total_amount"},{name:"orderStatus",label:"Order Status",field:"order_status"},{name:"courierDate",label:"Courier Date",field:"courier_date"},{name:"deliveryThrough",label:"Courier Company Name",field:"delivery_through"},{name:"deliveryNumber",label:"Courier Tracking Number",field:"delivery_number"},{name:"deliveryAddress",label:"Delivery Address",field:"delivery_address"},{name:"deliveryDate",label:"Delivery Date",field:"delivery_date"},{name:"paymentMode",label:"Payment Mode",field:"payment_mode"},{name:"paymentStatus",label:"Payment Status",field:"payment_status"},{name:"paymentDate",label:"Payment Date",field:"payment_date"},{name:"paymentReference",label:"Payment Reference",field:"payment_reference"}],w=[{name:"uid",required:!0,label:"Order Item Id",align:"left",field:t=>t.order_item_number,format:t=>`${t}`,sortable:!0},{name:"productName",label:"Product Name",field:"product_name"},{name:"quantity",label:"Quantity",field:"quantity"},{name:"hsnCode",label:"HSN Code",field:"hsn_code"},{name:"price",label:"Price (INR)",field:"price"},{name:"cgstPercentage",label:"CGST (%)",field:"cgst_percentage"},{name:"cgstAmount",label:"CGST Amount (INR)",field:"cgst_amount"},{name:"sgstPercentage",label:"SGST (%)",field:"sgst_percentage"},{name:"sgstAmount",label:"SGST Amount (INR)",field:"sgst_amount"},{name:"igstPercentage",label:"IGST (%)",field:"igst_percentage"},{name:"igstAmount",label:"IGST Amount (INR)",field:"igst_amount"},{name:"gstTotalAmount",label:"GST Total (INR)",field:"gst_total_amount"},{name:"totalAmount",label:"Total (INR)",field:"total_amount"}];const G=d(c),y=d([]),N=d(w),p=d([]),u=d([]),g=d(""),O=d(!1),T=d("Yet to be Couriered"),h=d(""),S=d("");let P=[{label:"yet_to_be_couriered",name:"Yet to be Couriered"},{label:"in_transit",name:"In transit"},{label:"delivered",name:"Delivered"},{label:"cancelled",name:"Cancelled"}];const $=i(()=>P.map(t=>t.name)),R=i(()=>P.find(e=>e.name===T.value).label),A=()=>{f.loading.show({spinner:Z,spinnerColor:"light-blue",messageColor:"white",backgroundColor:"light-blue",message:""})},Q=()=>{f.loading.hide()},M=(t=!1)=>{b.value=!1,t===!0&&(u.value=[],_())},q=()=>{b.value=!0},_=()=>{A();let t={fromDate:h.value==""?null:h.value,toDate:S.value==""?null:S.value,orderStatus:R.value};o.getOrders(t).then(e=>{n.value=e.data,y.value=e.data}).catch(e=>{console.log("errror",e)}).finally(()=>{Q()})},F=()=>{let t=n.value.find(e=>e.order_id===u.value[0].order_id).order_items;p.value=t},k=()=>{if(S.value<h.value){f.notify({message:"Order From Date should be less than or equal to Order To Date!!!",type:"negative",position:"top"});return}u.value=[],_()},E=()=>{A();let e=`${T.value.replace(/ /g,"_")}_registration_payments.xlsx`,a=[];for(let r of y.value){let U={"Order Id":r.order_id,"Order Date":r.order_date,"Customer Name":r.customer_name,"Mobile Number":r.mobile_number,"Referrer Id":r.referrer_id,"Referrer Name":r.referrer_name,"Referrer Mobile Number":r.referrer_mobile_number,"Total Product Price":r.total_product_price,"CGST Amount":r.order_cgst_amount,"SGST Amount":r.order_sgst_amount,"IGST Amount":r.order_igst_amount,"GST Total Amount":r.order_gst_total_amount,"Order Total Amount":r.order_total_amount,"Order Status":r.order_status,"Courier Date":r.courier_date,"Courier Company Name":r.delivery_through,"Courier Tracking Number":r.delivery_number,"Delivery Address":r.delivery_address,"Delivery Date":r.delivery_date,"Payment Mode":r.payment_mode,"Payment Status":r.payment_status,"Payment Date":r.payment_date};a.push(U)}be(a,e),Q()};return _e(u,t=>{t.length?F():p.value=[]}),z(()=>{_()}),(t,e)=>(I(),K(ve,null,[s("div",Ie,[s("div",Pe,[Ae,l(D,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),style:{"max-width":"150px"},outlined:"",dense:"",autofocus:"",type:"date"},null,8,["modelValue"])]),s("div",Qe,[ke,l(D,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=a=>S.value=a),style:{"max-width":"150px"},outlined:"",dense:"",autofocus:"",type:"date"},null,8,["modelValue"])]),s("div",Ue,[Ge,l(J,{filled:"",style:{width:"200px","max-height":"100px"},modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=a=>T.value=a),options:v($)},null,8,["modelValue","options"])]),s("div",$e,[l(V,{unelevated:"",color:"primary",label:"Search","no-caps":"",onClick:k})])]),s("div",Re,[l(V,{color:"green",class:"q-mb-md",style:{width:"20px"},"no-caps":"",onClick:E},{default:m(()=>[s("div",Me,[l(H,{name:"fas fa-file-excel"}),Fe])]),_:1}),l(W,{class:"orders-table",flat:"",bordered:"",title:"Orders",rows:y.value,columns:G.value,"row-key":"order_id",selection:"single",selected:u.value,"onUpdate:selected":e[5]||(e[5]=a=>u.value=a),filter:g.value},{"top-right":m(()=>[O.value?(I(),L(D,{key:0,filled:"",borderless:"",dense:"",debounce:"300",modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=a=>g.value=a),placeholder:"Search"},{append:m(()=>[l(H,{name:"search"})]),_:1},8,["modelValue"])):B("",!0),l(V,{class:"q-ml-sm",icon:"filter_list",onClick:e[4]||(e[4]=a=>O.value=!O.value),flat:""})]),_:1},8,["rows","columns","selected","filter"]),l(V,{class:"q-mt-md",color:"primary",label:"Edit",disable:!u.value.length||u.value[0].order_status==="Delivered",onClick:q},null,8,["disable"])]),u.value.length?(I(),K("div",Ee,[l(W,{class:"orders-table",flat:"",bordered:"",title:"Order Items",rows:p.value,columns:N.value,"row-key":"order_id",filter:g.value},null,8,["rows","columns","filter"])])):B("",!0),b.value?(I(),L(qe,{key:1,modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=a=>b.value=a),"show-new-user-popup":b.value,"close-new-user-popup":M,"selected-data":u.value},null,8,["modelValue","show-new-user-popup","selected-data"])):B("",!0)],64))}};export{ot as default};
