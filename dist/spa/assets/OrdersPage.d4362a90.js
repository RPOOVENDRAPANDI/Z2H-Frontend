import{_ as le,r as d,c as i,o as z,l as A,v as L,n as m,d as l,aB as B,A as V,q as s,t as re,u as oe,aG as y,M as v,bj as se,aA as de,b as ue,bk as ne,b5 as ie,aD as me,aE as ce,L as pe,w as _e,m as K,x as Y,F as ve,Q as H}from"./index.84e406f6.js";import{Q as J}from"./QSelect.c660601d.js";import{Q as W}from"./QTable.45c07f07.js";import{u as X}from"./use-quasar.eb8135c3.js";import{Q as Z}from"./QSpinnerFacebook.317364b6.js";import{u as ee}from"./general.26e1389d.js";import{Q as be}from"./TouchPan.2db7e4a4.js";import{Q as fe}from"./QScrollArea.83c641f4.js";import{Q as ye}from"./QForm.48a1f013.js";import{e as ge}from"./exportToExcel.7a526dc2.js";import"./format.caa0d1be.js";import"./QList.c2d242fe.js";import"./QMarkupTable.f3df12e7.js";import"./axios.95677817.js";import"./touch.3df10340.js";import"./QResizeObserver.d83a6f29.js";import"./QScrollObserver.3e0dacf6.js";import"./FileSaver.min.0ff652e7.js";const x=C=>(me("data-v-44e2286b"),C=C(),ce(),C),De=x(()=>s("div",{class:"text-h6 text-bold",style:{color:"#123499"}}," Edit Order Details ",-1)),he={class:"text-bold"},Se={class:"text-green"},xe=x(()=>s("div",{class:"text-bold q-mt-md"},"Delivery Date",-1)),Ce=x(()=>s("div",{class:"text-bold q-mt-md"},"Courier Date",-1)),we=x(()=>s("div",{class:"text-bold q-mt-md"},"Courier Tracking Number",-1)),Ne=x(()=>s("div",{class:"text-bold q-mt-xs"},"Name of the Courier",-1)),Te=x(()=>s("div",{class:"text-bold q-mt-xs"},"Delivery Address",-1)),Ve=x(()=>s("div",{class:"text-bold q-mt-xs"},"Order Status",-1)),Oe={__name:"editOrderDetailsModal",props:{showNewUserPopup:{type:Boolean,required:!0,default:!1},closeNewUserPopup:{type:Function,required:!0},selectedData:{type:Object,required:!0}},setup(C){const o=C,b=ee(),g=X(),n=d(""),c=d(""),w=d(o.selectedData[0].delivery_number),O=d(o.selectedData[0].customer_name),N=d(o.selectedData[0].delivery_through),f=d(o.selectedData[0].delivery_address),u=d(o.selectedData[0].order_status);let _=[{label:"yet_to_be_couriered",name:"Yet to be Couriered"},{label:"in_transit",name:"In Transit"},{label:"delivered",name:"Delivered"},{label:"cancelled",name:"Cancelled"}];const D=i({get:()=>o.showNewUserPopup,set:()=>o.closeNewUserPopup()}),T=i(()=>_.map(t=>t.name)),h=i(()=>["Yet to be Couriered","Delivered","Cancelled"].includes(o.selectedData[0].order_status)),S=i(()=>o.selectedData[0].order_status!=="Yet to be Couriered"),P=i(()=>o.selectedData[0].order_status==="In Transit"),q=i(()=>o.selectedData[0].order_status==="In Transit"),$=i(()=>o.selectedData[0].order_status==="In Transit"),R=i(()=>_.find(e=>e.name===u.value).label),Q=i(()=>{let t=p(w.value),e=p(N.value),a=p(f.value),r=u.value==="Yet to be Couriered",G=u.value==="In Transit",j=u.value==="Delivered",te=G&&c.value,ae=j&&n.value;return c.value&&n.value&&c.value>n.value||o.selectedData[0].order_status==="In Transit"&&!n.value||G&&n.value?!0:j?!ae:!t||!e||!a||r||!te}),k=()=>{g.loading.show({spinner:Z,spinnerColor:"light-blue",messageColor:"white",backgroundColor:"light-blue",message:""})},M=()=>{g.loading.hide()},I=(t=!1)=>{o.closeNewUserPopup(t)},p=t=>t&&t.toString().trim().length>0,F=()=>{let t=o.selectedData[0].order_status;t!=="Yet to be Couriered"&&(t==="In Transit"?_=[{label:"delivered",name:"Delivered"},{label:"cancelled",name:"Cancelled"}]:(t==="Delivered"||t==="Cancelled")&&(_=[]))},U=t=>{const[e,a,r]=t.split("-");return`${r}-${a}-${e}`},E=()=>{var e;k(),console.log("courier date",c.value);let t={delivery_date:(e=n.value)!=null?e:null,courier_date:c.value,delivery_details:{delivery_through:N.value,delivery_number:w.value,delivery_address:f.value},order_status:R.value};b.updateOrders(t,o.selectedData[0].uid).then(a=>{I(!0),g.notify({message:"Order Details Updated Successfully!!!",type:"positive",position:"top"})}).catch(a=>{g.notify({message:"Something went Wrong. Please contact your admin!!!",type:"negative",position:"top"})}).finally(()=>{M()})};return z(()=>{o.selectedData[0].courier_date&&(c.value=U(o.selectedData[0].courier_date)),o.selectedData[0].delivery_date&&(n.value=U(o.selectedData[0].delivery_date)),F()}),(t,e)=>(A(),L(ie,{modelValue:v(D),"onUpdate:modelValue":e[6]||(e[6]=a=>ue(D)?D.value=a:null),persistent:"",onKeydown:ne(I,["esc"])},{default:m(()=>[l(de,{class:"order-modal"},{default:m(()=>[l(B,{class:"row items-center"},{default:m(()=>[De,l(be),l(V,{icon:"close",flat:"",round:"",onClick:I})]),_:1}),l(ye,{onSubmit:E},{default:m(()=>[l(fe,{style:{height:"calc(95vh - 170px)"}},{default:m(()=>[l(B,null,{default:m(()=>[s("div",he,[re(" Customer - "),s("span",Se,oe(O.value),1)]),xe,l(y,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),style:{"max-width":"200px"},outlined:"",dense:"",autofocus:"",type:"date",disable:v(h)},null,8,["modelValue","disable"]),Ce,l(y,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),style:{"max-width":"200px"},outlined:"",dense:"",autofocus:"",type:"date",disable:v(S)},null,8,["modelValue","disable"]),we,l(y,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=a=>w.value=a),style:{"max-width":"400px"},outlined:"",dense:"",autofocus:"",placeholder:"Enter a Courier Tracking Number",maxlength:"128",rules:[a=>p(a)||"Field is required!!!"],disable:v(P)},null,8,["modelValue","rules","disable"]),Ne,l(y,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=a=>N.value=a),style:{"max-width":"400px"},outlined:"",dense:"",autofocus:"",placeholder:"Enter a Name of the Courier",maxlength:"128",rules:[a=>p(a)||"Field is required!!!"],disable:v(q)},null,8,["modelValue","rules","disable"]),Te,l(y,{modelValue:f.value,"onUpdate:modelValue":e[4]||(e[4]=a=>f.value=a),type:"textarea",style:{width:"400px"},outlined:"",dense:"",autofocus:"",rows:"2",placeholder:"Enter Delivery address.","input-class":"textarea-input",rules:[a=>p(a)||"Field is required!!!"],disable:v($)},null,8,["modelValue","rules","disable"]),Ve,l(J,{style:{width:"320px"},filled:"",modelValue:u.value,"onUpdate:modelValue":e[5]||(e[5]=a=>u.value=a),options:v(T)},null,8,["modelValue","options"])]),_:1})]),_:1}),l(B,{class:"row justify-end"},{default:m(()=>[l(se,{class:"q-px-none"},{default:m(()=>[l(V,{unelevated:"",color:"primary",label:"Save",type:"submit","no-caps":"",disable:v(Q)},null,8,["disable"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","onKeydown"]))}};var qe=le(Oe,[["__scopeId","data-v-44e2286b"]]);const Ie={class:"row q-pt-md q-ml-lg"},Ae={class:"col-2"},Pe=s("p",{style:{color:"#123499"},class:"text-bold"},"From Date",-1),Qe={class:"col-2"},ke=s("p",{style:{color:"#123499"},class:"text-bold"},"To Date",-1),Ue={class:"col-2"},Ge=s("p",{style:{color:"#123499"},class:"text-bold"},"Courier Status",-1),$e={class:"col-2 q-ml-lg q-mt-lg"},Re={class:"q-ml-md q-mt-sm q-mr-lg q-pa-md"},Me={class:"row justify-start items-center"},Fe=s("span",{class:"q-ml-sm"},null,-1),Ee={key:0,class:"q-ml-md q-mt-sm q-mr-lg q-pa-md"},ut={__name:"OrdersPage",setup(C){const o=ee(),b=d(!1),{orders:g}=pe(o);let n=[{name:"orderId",required:!0,label:"Order Id",align:"left",field:t=>t.order_id,format:t=>`${t}`,sortable:!0},{name:"orderDate",label:"Order Date",field:"order_date",sortable:!0},{name:"customerName",label:"Customer Name",field:"customer_name"},{name:"mobileNumber",label:"Mobile Number",field:"mobile_number"},{name:"referrerId",label:"Referrer Id",field:"referrer_id"},{name:"referrerName",label:"Referrer Name",field:"referrer_name"},{name:"referrerMobileNumber",label:"Referrer Mobile Number",field:"referrer_mobile_number"},{name:"totalProductPrice",label:"Total Product Price",field:"total_product_price"},{name:"cgst",label:"CGST Amount",field:"order_cgst_amount"},{name:"sgst",label:"SGST Amount",field:"order_sgst_amount"},{name:"igst",label:"IGST Amount",field:"order_igst_amount"},{name:"gstTotal",label:"GST Total Amount",field:"order_gst_total_amount"},{name:"orderTotal",label:"Order Total Amount",field:"order_total_amount"},{name:"orderStatus",label:"Order Status",field:"order_status"},{name:"courierDate",label:"Courier Date",field:"courier_date"},{name:"deliveryThrough",label:"Courier Company Name",field:"delivery_through"},{name:"deliveryNumber",label:"Courier Tracking Number",field:"delivery_number"},{name:"deliveryAddress",label:"Delivery Address",field:"delivery_address"},{name:"deliveryDate",label:"Delivery Date",field:"delivery_date"},{name:"paymentMode",label:"Payment Mode",field:"payment_mode"},{name:"paymentStatus",label:"Payment Status",field:"payment_status"},{name:"paymentDate",label:"Payment Date",field:"payment_date"},{name:"paymentReference",label:"Payment Reference",field:"payment_reference"}],c=[{name:"uid",required:!0,label:"Order Item Id",align:"left",field:t=>t.order_item_number,format:t=>`${t}`,sortable:!0},{name:"productName",label:"Product Name",field:"product_name"},{name:"quantity",label:"Quantity",field:"quantity"},{name:"hsnCode",label:"HSN Code",field:"hsn_code"},{name:"price",label:"Price (INR)",field:"price"},{name:"cgstPercentage",label:"CGST (%)",field:"cgst_percentage"},{name:"cgstAmount",label:"CGST Amount (INR)",field:"cgst_amount"},{name:"sgstPercentage",label:"SGST (%)",field:"sgst_percentage"},{name:"sgstAmount",label:"SGST Amount (INR)",field:"sgst_amount"},{name:"igstPercentage",label:"IGST (%)",field:"igst_percentage"},{name:"igstAmount",label:"IGST Amount (INR)",field:"igst_amount"},{name:"gstTotalAmount",label:"GST Total (INR)",field:"gst_total_amount"},{name:"totalAmount",label:"Total (INR)",field:"total_amount"}];const w=d(n),O=d([]),N=d(c),f=d([]),u=d([]),_=d(""),D=d(!1),T=d("Yet to be Couriered"),h=d(""),S=d("");let P=[{label:"yet_to_be_couriered",name:"Yet to be Couriered"},{label:"in_transit",name:"In transit"},{label:"delivered",name:"Delivered"},{label:"cancelled",name:"Cancelled"}];const q=X(),$=i(()=>P.map(t=>t.name)),R=i(()=>P.find(e=>e.name===T.value).label),Q=()=>{q.loading.show({spinner:Z,spinnerColor:"light-blue",messageColor:"white",backgroundColor:"light-blue",message:""})},k=()=>{q.loading.hide()},M=(t=!1)=>{b.value=!1,t===!0&&(u.value=[],p())},I=()=>{b.value=!0},p=()=>{Q();let t={fromDate:h.value==""?null:h.value,toDate:S.value==""?null:S.value,orderStatus:R.value};o.getOrders(t).then(e=>{g.value=e.data,O.value=e.data}).catch(e=>{console.log("errror",e)}).finally(()=>{k()})},F=()=>{let t=g.value.find(e=>e.order_id===u.value[0].order_id).order_items;f.value=t},U=()=>{if(S.value<h.value){q.notify({message:"Order From Date should be less than or equal to Order To Date!!!",type:"warning",position:"top"});return}u.value=[],p()},E=()=>{Q();let e=`${T.value.replace(/ /g,"_")}_registration_payments.xlsx`,a=[];for(let r of O.value){let G={"Order Id":r.order_id,"Order Date":r.order_date,"Customer Name":r.customer_name,"Mobile Number":r.mobile_number,"Referrer Id":r.referrer_id,"Referrer Name":r.referrer_name,"Referrer Mobile Number":r.referrer_mobile_number,"Total Product Price":r.total_product_price,"CGST Amount":r.order_cgst_amount,"SGST Amount":r.order_sgst_amount,"IGST Amount":r.order_igst_amount,"GST Total Amount":r.order_gst_total_amount,"Order Total Amount":r.order_total_amount,"Order Status":r.order_status,"Courier Date":r.courier_date,"Courier Company Name":r.delivery_through,"Courier Tracking Number":r.delivery_number,"Delivery Address":r.delivery_address,"Delivery Date":r.delivery_date,"Payment Mode":r.payment_mode,"Payment Status":r.payment_status,"Payment Date":r.payment_date};a.push(G)}ge(a,e),k()};return _e(u,t=>{t.length?F():f.value=[]}),z(()=>{p()}),(t,e)=>(A(),K(ve,null,[s("div",Ie,[s("div",Ae,[Pe,l(y,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),style:{"max-width":"150px"},outlined:"",dense:"",autofocus:"",type:"date"},null,8,["modelValue"])]),s("div",Qe,[ke,l(y,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=a=>S.value=a),style:{"max-width":"150px"},outlined:"",dense:"",autofocus:"",type:"date"},null,8,["modelValue"])]),s("div",Ue,[Ge,l(J,{filled:"",style:{width:"200px","max-height":"100px"},modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=a=>T.value=a),options:v($)},null,8,["modelValue","options"])]),s("div",$e,[l(V,{unelevated:"",color:"primary",label:"Search","no-caps":"",onClick:U})])]),s("div",Re,[l(V,{color:"green",class:"q-mb-md",style:{width:"20px"},"no-caps":"",onClick:E},{default:m(()=>[s("div",Me,[l(H,{name:"fas fa-file-excel"}),Fe])]),_:1}),l(W,{class:"orders-table",flat:"",bordered:"",title:"Orders",rows:O.value,columns:w.value,"row-key":"order_id",selection:"single",selected:u.value,"onUpdate:selected":e[5]||(e[5]=a=>u.value=a),filter:_.value},{"top-right":m(()=>[D.value?(A(),L(y,{key:0,filled:"",borderless:"",dense:"",debounce:"300",modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=a=>_.value=a),placeholder:"Search"},{append:m(()=>[l(H,{name:"search"})]),_:1},8,["modelValue"])):Y("",!0),l(V,{class:"q-ml-sm",icon:"filter_list",onClick:e[4]||(e[4]=a=>D.value=!D.value),flat:""})]),_:1},8,["rows","columns","selected","filter"]),l(V,{class:"q-mt-md",color:"primary",label:"Edit",disable:!u.value.length||u.value[0].order_status==="Delivered",onClick:I},null,8,["disable"])]),u.value.length?(A(),K("div",Ee,[l(W,{class:"orders-table",flat:"",bordered:"",title:"Order Items",rows:f.value,columns:N.value,"row-key":"order_id",filter:_.value},null,8,["rows","columns","filter"])])):Y("",!0),b.value?(A(),L(qe,{key:1,modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=a=>b.value=a),"show-new-user-popup":b.value,"close-new-user-popup":M,"selected-data":u.value},null,8,["modelValue","show-new-user-popup","selected-data"])):Y("",!0)],64))}};export{ut as default};
